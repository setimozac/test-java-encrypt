name: encrypt-passwords
on: 
  workflow_dispatch:
    inputs:
      password:
        required: true
        type: string
      
jobs:
  encryption:
    runs-on: ubuntu-latest
    steps:
      # - name: Get Code
      #   uses: actions/checkout@v3

      - name: Get Password
        run: |
          PASS=$(jq -r '.inputs.password' $GITHUB_EVENT_PATH)
          echo ::add-mask::$PASS
          echo PASS=$PASS >> $GITHUB_ENV

      - name: Get Key
        run: |
          KEY=$(jq -r '.inputs.key' $GITHUB_EVENT_PATH)
          echo ::add-mask::$KEY
          echo KEY=$KEY >> $GITHUB_ENV

      - name: Set up Java 8
        uses: actions/setup-java@v2
        with:
          distribution: 'adopt'
          java-version: 8
          java-package: 'jdk'

      - name: Install SDKMAN
        run: |
          curl -s "https://get.sdkman.io" | bash
          # source "$HOME/.sdkman/bin/sdkman-init.sh"
          source "/home/runner/.sdkman/bin/sdkman-init.sh"
          sdk version
          sdk list springboot

      - name: Install Springboot CLI
        run: |
          source "/home/runner/.sdkman/bin/sdkman-init.sh"
          sdk install springboot 2.0.1 
          spring --version
          spring install org.springframework.cloud:spring-cloud-cli:1.3.2.RELEASE
          echo "==========encypting========="
          spring encrypt "${{ env.PASS }}" --key 'ABC'

      - name: encrypt
        run: |
          source "/home/runner/.sdkman/bin/sdkman-init.sh"
          echo "==========encypting2========="
          spring encrypt "${{ env.PASS }}" --key "${{ env.KEY }}"
